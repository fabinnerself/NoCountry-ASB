1 antecendetne codigo de fornt ent/backe local y en linea: vercel ->frontEnd) y render-> backend
2 fase 0 plan, taks en dir fase0 "C:\nocountry\3\plan\fase0"
3 no desarrollar de 0 sobre actual codigo imlemntar con  tdd, 4ta variable imagen de manera que con camption
    determine elementos y esos textos (captions) los ponga en el promt parametrico y genere mejor resultado de hisotoria
    el catual model ia cohere podra? si no proponer otro modelo ia gratuito
    no validar que la imagen sea valida sino que con una imagen de prueba desarrollar si al final el resultado
    funciona con la imagen asumire que funciona con cualquier imagen y luego validare


# Fase/Iteraci√≥n 1: Desarrollo de 4ta variable imagen
## üéØ Objetivo General - Iteraci√≥n 1
Desarrollar y validar la funci√≥n base que obtendra los captions de 1 imagen que ser√° llamada desde el endpoint `/api/generate-story`, utilizando TDD y preparando la infraestructura para fases posteriores con PostgreSQL .

## Objetivo Final (Full Project)
Desarrollar AutoStory Builder completo seg√∫n la definici√≥n en `desc_gral_proy_auto_store-builder.txt`: sistema de IA para generar historias visuales y textuales a partir de inputs multimedia, con panel de edici√≥n, exportaci√≥n y RAG.

## üìã Alcance de Fase 1

### Endpoint Principal: POST /api/generate-story

**Input JSON:**
```json
{
  "tone": "INSPIRACIONAL" | "EDUCATIVO" | "T√âCNICO",
  "format": "HISTORIA" | "POST" | "REDES_SOCIALES" | "OTRO",
  "text": "string (min 20, max 1000 chars)",
  "image": JPG, PNG, WEBP, testimonios < 10 MB
}
```

**Output JSON:**
```json
{
  "success": "ok",
  "generatedStory": "string (historia generada)",
  "validation": {
    "tone": "ok" | "error",
    "format": "ok" | "error",
    "text": "ok" | "error",
    "image":"ok"| "error"
  },
  "metadata": {
    "wordCount": 95,
    "tone": "INSPIRACIONAL",
    "format": "REDES_SOCIALES",
    "generatedAt": "2025-12-09T02:13:27.227Z",
    "model": "command-r-plus"
  }
}
```

### Entrada (4 variables iniciales)
- `tone`: String - Tono de la narrativa
  - Valores v√°lidos: "INSPIRACIONAL", "EDUCATIVO", "T√âCNICO"
- `format`: String - Formato de salida
  - Valores v√°lidos: "HISTORIA", "POST", "REDES_SOCIALES", "OTRO"
- `text`: String - Contexto/informaci√≥n base para la historia
  - Longitud: 20-1000 caracteres
- image: imagen , formatos validos: PG, PNG, WEBP tama√±o: menor a 10 MB

 

---

## üèóÔ∏è Arquitectura T√©cnica

### Stack Tecnol√≥gico

**Backend:**
- Node.js/Express (c√≥digo base existente)
- PostgreSQL + pgvector extension
- Prisma ORM
- Jest/Mocha (TDD)
- Deployment: Render

**Frontend:**
- Core: React (v18+), Vite
- Estilos: Tailwind CSS
- Componentes UI: Radix UI
- Iconos: Lucide React
- Formularios: React Hook Form
- Gr√°ficos: Recharts
- Notificaciones: Sonner
- Temas: Next Themes
- Deployment: Vercel

**IA:**
- Cohere API (https://dashboard.cohere.com/playground/chat)
- API Key configurada en .env ‚Üí COHERE_API_KEY

### Variables de Entorno (.env)

```env
# ============================================
# SERVER CONFIGURATION
# ============================================
PORT=8000

# ============================================
# DATABASE CONFIGURATION
# ============================================
DATABASE_URL="postgresql://postgres:postgres@localhost:5432/autostory_db?schema=public"

# ============================================
# API KEYS
# ============================================
COHERE_API_KEY="***************************"

# ============================================
# CORS - FRONTEND URLS
# ============================================
FRONTEND_URL_LOCAL="http://localhost:5173"
FRONTEND_URL="https://tu-frontend.vercel.app"

# ============================================
# ENVIRONMENT
# ============================================
NODE_ENV="development"

# ============================================
# PUERTOS - GU√çA R√ÅPIDA
# ============================================
# Backend API:     http://localhost:8000
# PostgreSQL:      localhost:5432
# Frontend (Vite): http://localhost:5173
# ============================================
```

### Validaciones y Reglas

**Campos requeridos:** `tone`, `format`, `text`

**Dominios v√°lidos:**
- `tone`: "INSPIRACIONAL", "EDUCATIVO", "T√âCNICO"
- `format`: "HISTORIA", "POST", "REDES_SOCIALES", "OTRO"
- `text`: 20-1000 caracteres

**Mensajes de error:**
- Tono inv√°lido: `"Valor de tone no v√°lido: [valor recibido]. Valores permitidos: INSPIRACIONAL, EDUCATIVO, T√âCNICO"`
- Formato inv√°lido: `"Valor de format no v√°lido: [valor recibido]. Valores permitidos: HISTORIA, POST, REDES_SOCIALES, OTRO"`
- Texto inv√°lido: `"El texto debe tener entre 20 y 1000 caracteres. Recibido: [longitud]"`

**Validaci√≥n de output:**
- Longitud: 80-120 palabras
- Estructura: Gancho ‚Üí Desarrollo ‚Üí Cierre inspirador
- Incluir llamado a la acci√≥n (para formatos de redes sociales)

---

## üîß Implementaci√≥n Paso a Paso

pasos que correspondan
adecuara codigo actaul de endpoint  /api/generate-story
para que reciba imagen, 
volver la imagen medinate modelo IA (mejor si cohere) en cpations descripciones textuales de la image
ajustar prompot para que se incluya esa informacion de maneraa parametrica


## ‚úÖ Criterios de Validaci√≥n (DoD)

- [ ] Tests unitarios pasan al 100%
- [ ] Endpoint responde correctamente con 4 variables
- [ ] Historias generadas cumplen 80-120 palabras
- [ ] Manejo de errores implementado con mensajes claros
- [ ] Documentaci√≥n API actualizada
- [ ] C√≥digo conectado al backend/frontend existente
- [ ] Variables de entorno configuradas
- [ ] Schema Prisma definido para futura persistencia
- [ ] Validaciones de input funcionando correctamente
- [ ] Validaciones de output implementadas
- [ ] archivo json para importar en postman para que se pruebe facilemtne la funcionalidad de imagen
- [ ] los test debera ub icarse en directorio backend/test/img
- [ ] la doumetnacion de esta fase se ubicara en directorio backend/doc/img
- [ ] ajustara actual  archivo readme.md con nuevas consideraciones de etapa 1


## üöÄ Siguiente Fase (Preparaci√≥n)

Una vez validada Fase 0, preparar para:
- usar mediante prisma bd postgres para almacenar la info de las 4 variables

## üìö Recursos y Referencias

- [Cohere API Docs](https://docs.cohere.com/)
- [Prisma + PostgreSQL](https://www.prisma.io/docs/concepts/components/prisma-client/databases/postgresql)
- [pgvector Extension](https://github.com/pgvector/pgvector)
- C√≥digo base etapa 1: `C:\nocountry\3\` + C:\nocountry\3\plan
- Estructura de BD propuesta: `C:\nocountry\3\plan\db_struct.sql`
- Descripci√≥n general del proyecto: `C:\nocountry\3\plan\desc_gral_proy_auto_store-builder.txt`



## üêõ Debugging & Testing

### Testing Local

```bash
# 1. Instalar dependencias
npm install

# 2. Configurar variables de entorno
cp .env.example .env
# Editar .env con tus credenciales

# 3. Ejecutar tests
npm test

# 4. Iniciar servidor de desarrollo
npm run dev

# 5. Probar endpoint
curl -X POST http://localhost:8000/api/generate-story \
  -H "Content-Type: application/json" \
  -d '{
    "tone": "INSPIRACIONAL",
    "format": "REDES_SOCIALES",
    "text": "Joven de comunidad rural accedi√≥ a programa de becas tecnol√≥gicas. Super√≥ barreras de conectividad y hoy trabaja como desarrollador remoto, ayudando a su familia."
  }'
```

### Validaci√≥n Manual

1. Verificar que el story cumple 80-120 palabras
2. Confirmar que refleja el tono solicitado
3. Validar estructura: gancho ‚Üí desarrollo ‚Üí cierre
4. Comprobar llamado a la acci√≥n presente (para REDES_SOCIALES)
5. Verificar que el formato es apropiado

---

## üìù Notas de Implementaci√≥n

- **TDD First:** Escribir tests antes del c√≥digo
- **C√≥digo Base:** Usar el c√≥digo funcional existente como base
- **Modularidad:** Mantener la funci√≥n modular para f√°cil integraci√≥n de imagen en fases posteriores
- **Documentaci√≥n:** Documentar decisiones t√©cnicas importantes
- **Commits:** Realizar commits at√≥micos por funcionalidad
- **Consistencia:** Usar nombres de variables en ingl√©s en el c√≥digo, espa√±ol en la documentaci√≥n

---

## üîÑ Evoluci√≥n del Contrato API

### Fase 1 (Actual)
- Input: `tone`, `format`, `text`, 'image'
- Output: `success`, `generatedStory`, `validation`, `metadata`

### Fase 2 (Futura)
- Input adicional: `idUser`, `operacion` ("GENERAR" | "REGENERAR" | "EDITAR"), `image` 
- Output adicional: `id_story` (UUID), persistencia en BD

### Fase 3+ (Futura)
- RAG: B√∫squeda sem√°ntica de historias similares
- An√°lisis de imagen con IA
- Panel de edici√≥n interactivo
- Exportaci√≥n en m√∫ltiples formatos

